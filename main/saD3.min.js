/**
 *  @fileOverview saD3 is a javascript library extending the d3
 * functionality of common graphs matching the conventions perscribed
 * by Sangwa Solutions
 *
 *  @author       Jamie Sgro
 *
 *  @requires     {@link https://d3js.org/d3.v5.min.js d3.v5}
 *
 *  @license
 *     Copyright 2019 Sangwa / Sangwa Libraries
 *
 *    Licensed under the Apache License, Version 2.0 (the "License");
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an "AS IS" BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
 *    limitations under the License
 */
class Base_D3{constructor(t,a,e,i){this.margin=e,this.width=t-this.margin.left-this.margin.right,this.height=a-this.margin.top-this.margin.bottom,this.colourBottom=i.bottom,this.colourTop=i.top,this.getSvgSize=function(t,a){t.attr("width",a.width+a.margin.left+a.margin.right).attr("height",a.height+a.margin.top+a.margin.bottom)},this.svg=d3.select("body").append("svg").attr("class","graph svg").call(this.getSvgSize,this),this.canvas=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")")}getDomain(t){return[d3.min(t),d3.max(t)]}prePlot(){}getAttr(t,a,e){for(var i in e)a["_getAttr_"+e[i]](t,a)}getXAxis(t,a){t.attr("transform","translate(0,"+a.height+")").call(d3.axisBottom(a.getWidthScale(a.domain)))}getYAxis(t,a,e){t.call(d3.axisLeft(a.getHeightScale(e)))}plot(t){var a=this.prePlot(t);this.canvas.selectAll("rect.bar").data(a).enter().append("rect").attr("class","bar").call(this.getAttr,this,["x","y","width","height","fill"]),this.canvas.append("g").attr("class","x axis").call(this.getXAxis,this),this.canvas.append("g").attr("class","y axis").call(this.getYAxis,this,a),this.postPlot()}}class Histogram extends Base_D3{constructor(t,a,e,i,r){super(t,a,e,i),this.binNum=r,this.yLabel="value",this.max=0,this.min=0,this.widthScale=function(){},this.heightScale=function(){}}getColour(t){this.yLabel;return d3.scaleLinear().domain([0,d3.max(t,function(t){return t.length})]).range([this.colourBottom,this.colourTop])}getHeightScale(t){return d3.scaleLinear().domain([0,d3.max(t,function(t){return t.length})]).range([this.height,0])}getWidthScale(){}getBins(t,a){return d3.histogram().domain(t.widthScale.domain()).thresholds(t.widthScale.ticks(t.binNum))(a)}_getAttr_x(t,a){t.attr("x",function(t){return a.widthScale(t.x0)})}_getAttr_y(t,a){t.attr("y",function(t){return a.heightScale(t.length)})}_getAttr_width(t,a){t.attr("width",function(e){var i=t.data();return a.widthScale(i[0].x1)-a.widthScale(i[0].x0)-1})}_getAttr_height(t,a){t.attr("height",function(t){return a.height-a.heightScale(t.length)})}_getAttr_fill(t,a){a.yLabel;var e=a.getColour(t.data());t.attr("fill",function(t){return e(t.length)})}parseRawData(t){}prePlot(t){var a=this.parseRawData(this,t);this.domain=this.getDomain(a),this.widthScale=this.getWidthScale(this.domain);var e=this.getBins(this,a);return this.heightScale=this.getHeightScale(e),e}postPlot(){this.canvas.selectAll("rect.bar").attr("transform","translate(1,0)")}}class Histogram_Int extends Histogram{constructor(t,a,e,i,r){super(t,a,e,i,r)}getWidthScale(t){return d3.scaleLinear().domain([0,t[1]]).rangeRound([0,this.width]).nice()}parseRawData(t,a){return a.map(function(a,e){return parseFloat(a[t.yLabel])})}}class Histogram_Date extends Histogram{constructor(t,a,e,i,r){super(t,a,e,i,r)}getWidthScale(t){return d3.scaleTime().domain(t).rangeRound([0,this.width]).nice()}parseRawData(t,a){var e=d3.timeParse("%Y-%m-%d");return a.map(function(a,i){return e(a[t.yLabel])})}}class Bargraph extends Base_D3{constructor(t,a,e,i){super(t,a,e,i),this.xLabel="start_date",this.yLabel="value",this.max=0,this.min=0,this.widthScale=function(){},this.heightScale=function(){}}getColour(t){var a=this.yLabel;return d3.scaleLinear().domain([0,d3.max(t,function(t){return t[a]})]).range([this.colourBottom,this.colourTop])}getHeightScale(t){var a=this.yLabel;return d3.scaleLinear().domain([0,d3.max(t,function(t){return t[a]})]).range([this.height,0])}getWidthScale(t){return d3.scaleTime().domain(t).range([0,this.width]).nice()}_getAttr_x(t,a){t.attr("x",function(t){return a.widthScale(t[a.xLabel])})}_getAttr_y(t,a){t.attr("y",function(t){var e=a.yLabel;return a.heightScale(t[e])})}_getAttr_width(t,a){var e=t.data().map(function(t){return t[a.xLabel]}),i=d3.extent(e),r=d3.timeDay.count(i[0],i[1])+1;t.attr("width",a.width/r)}_getAttr_height(t,a){var e=a.yLabel;t.attr("height",function(t){return a.height-a.heightScale(t[e])})}_getAttr_fill(t,a){var e=a.yLabel,i=a.getColour(t.data());t.attr("fill",function(t){return i(t[e])})}_getAttr_fillTransparent(t,a){var e=a.getColour(t.data());t.attr("fill",function(t){return rtn=e(t[yLabel]),setAlpha(rtn,0)})}_getAttr_cx(t,a){t.attr("cx",function(t){return a.widthScale(t[yLabel])})}_getAttr_cy(t,a){t.attr("cy",function(t){return a.heightScale(t.name)})}_getAttr_r(t,a){t.attr("r",a.heightScale.bandwidth()/2)}parseRawData(t,a){var e=d3.timeParse("%Y-%m-%d");return a.map(function(a,i){return{[t.xLabel]:e(a[t.xLabel]),[t.yLabel]:a[t.yLabel]}})}prePlot(t){var a=this.parseRawData(this,t),e=this.xLabel,i=a.map(function(t){return t[e]});return this.domain=this.getDomain(i),this.domain[1]=d3.timeDay.offset(this.domain[1],1),this.widthScale=this.getWidthScale(this.domain),this.heightScale=this.getHeightScale(a),a}postPlot(){}}
